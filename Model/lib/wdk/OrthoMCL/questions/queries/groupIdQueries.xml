<?xml version="1.0" encoding="UTF-8"?>
<wdkModel>

    <!-- *************** -->
    <!-- model querySets -->
    <!-- *************** -->

    <!--
    A "query" obtains tabular values from a data source.  It has columns
    and parameters.  So far, only SQL data sources are supported, but others,
    such as flat files are coming.  

    Queries are used for different purposes: providing primary keys to a 
    question; providing attributes and tables to a record; and, providing
    vocabularies to vocabulary parameters.

    A "query set" is a grouping of queries.  It is useful in organizing the
    model xml file.  

    The full name of a query is of the form "set_name.name."
    -->


    <!-- Queries that return RNA primary keys (for use in questions and nested records.). -->

    <querySet name="GroupIds" queryType="id">
        <sqlQuery name="ByName" isCacheable="true">
            <paramRef ref="groupParams.group_names"/>
            <column name="name"/>
            <sql>
                <!-- use CDATA because query includes angle brackets -->
                <![CDATA[
SELECT og.name
FROM apidb.OrthologGroup og, ($$group_ids$$) ds
WHERE og.name = ds.name
UNION
SELECT ogs.ortholog_group_id
FROM apidb.OrthologGroupAaSequence ogs,
     Dots.AaSequenceDbRef seqref, Sres.DbRef ref,
     Sres.ExternalDatabase db, Sres.ExternalDatabaseRelease dbr,
	 ($$group_ids$$) ds
WHERE ogs.aa_sequence_id = seqref.aa_sequence_id
  AND seqref.db_ref_id = ref.db_ref_id
  AND ref.external_database_release_id = dbr.external_database_release_id
  AND dbr.external_database_id = db.external_database_id
  AND db.name = 'OrthoMCL Old Groups'
  AND ref.primary_identifier = ds.name
				]]>
            </sql>
        </sqlQuery>  

        <sqlQuery name="ByKeyword">
            <paramRef ref="sharedParams.keyword"/>
            <column name="name"/>
            <sql>
                <!-- use CDATA because query includes angle brackets -->
                <![CDATA[
SELECT DISTINCT ogs.ortholog_group_id
FROM apidb.OrthologGroupAaSequence ogs,
     dots.AaSequenceImp asi
WHERE ogs.aa_sequence_id = asi.aa_sequence_id
  AND asi.subclass_view = 'ExternalAASequence'
  AND ogs.ortholog_group_id != 0
  AND CATSEARCH(asi.description, $$keyword$$, '')>0
GROUP BY ogs.ortholog_group_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="EstParent">
            <column name="na_sequence_id"/>
            <column name="est_id"/>
            <column name="project_id"/>
            <sql>
                   select a.na_sequence_id, a.na_sequence_id AS est_id, '@PROJECT_ID@' || '' AS project_id
                   from WDKTestAssembly a, WDKTestAssemblySequence aseq
                        where aseq.assembly_na_sequence_id = a.na_sequence_id
            </sql>
        </sqlQuery>

 <processQuery name="ByMotifSearch" 
             processName="org.apidb.apicomplexa.wsfplugin.motifsearch.MotifSearchPlugin">
       <paramRef ref="params.motif_expression" />
       <paramRef ref="params.motif_organism" quote="false" />
       <wsColumn name="na_sequence_id" width="32" wsName="GeneID"/>
       <wsColumn name="project_id" width="32" wsName="ProjectId"/>
       <wsColumn name="Locations" width="3999"/>
       <wsColumn name="MatchCount" width="10"/>
       <wsColumn name="Sequence" width="3999"/>
    </processQuery>

    </querySet>

</wdkModel>
