<?xml version="1.0" encoding="UTF-8"?>
<wdkModel>

    <!-- *************** -->
    <!-- model querySets -->
    <!-- *************** -->

    <!--
    A "query" obtains tabular values from a data source.  It has columns
    and parameters.  So far, only SQL data sources are supported, but others,
    such as flat files are coming.  

    Queries are used for different purposes: providing primary keys to a 
    question; providing attributes and tables to a record; and, providing
    vocabularies to vocabulary parameters.

    A "query set" is a grouping of queries.  It is useful in organizing the
    model xml file.  

    The full name of a query is of the form "set_name.name."
    -->

    <!-- Queries that retrieve attributes of ESTs -->
    
    <querySet name="SequenceAttributes" queryType="attribute">

       <defaultTestParamValues>
            <paramValue name="source_id">PF11_0344</paramValue>
       </defaultTestParamValues>

        <testRowCountSql>
            SELECT count(*) FROM dots.ExternalAaSequence
        </testRowCountSql>

        <sqlQuery name="AllSequences">
            <column name="source_id"/>
            <sql>
            <![CDATA[
                SELECT eas.source_id
                FROM dots.ExternalAaSequence eas
			]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="SequenceAttrs">
            <column name="source_id"/>
            <column name="length"/>
            <column name="product"/>
            <column name="molecular_weight"/>
            <column name="full_source_id"/>
            <sql>
			<![CDATA[
                SELECT eas.source_id, eas.length, eas.description AS product,
					   eas.molecular_weight, eas.secondary_identifier AS full_source_id
                FROM dots.ExternalAaSequence eas
 			]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="SequenceOrganism">
            <column name="source_id"/>
            <column name="organism"/>
            <sql>
			<![CDATA[
                SELECT eas.source_id, ot.name AS organism
                FROM apidb.OrthomclTaxon ot, dots.ExternalAaSequence eas
				WHERE eas.taxon_id = ot.taxon_id
 			]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="SequenceGroup">
            <column name="source_id"/>
            <column name="group_name"/>
            <sql>
			<![CDATA[
                SELECT eas.source_id, og.name AS group_name
                FROM dots.ExternalAaSequence eas
				LEFT JOIN apidb.OrthologGroupAaSequence ogs
					ON eas.aa_sequence_id = ogs.aa_sequence_id
				LEFT JOIN apidb.OrthologGroup og
					ON ogs.ortholog_group_id = og.ortholog_group_id
 			]]>
            </sql>
        </sqlQuery>


	</querySet>

</wdkModel>
