#!/usr/bin/perl 

use strict;

use lib "@targetDir@/lib/perl";
$ENV{GUS_HOME} = '@targetDir@';

use OrthoMCLData::Load::MatrixColumnManager;
use ApiCommonWebsite::Model::ModelConfig;

my $groupName = $ARGV[0] || die "usage: orthomclGroupProfile group_name \n";

my $dbh = &getDbHandle();
my $sql = "
select m.*
from apidb.grouptaxonmatrix m, apidb.orthologgroup g
where g.name = '$name'
and  m.ortholog_group_id = g.ortholog_group_id
";


my $colMgr = OrthoMCLData::Load::MatrixColumnManager->new($dbh);

my $stmt = &getDbHandle()->prepare($sql);
$stmt->execute();
while (my $row = $stmt->getrow_hashref()) {
  foreach my $col (keys(%$row)) {
    my ($taxonAbbrev, $proteinOrTaxonFlag) = $colMgr->getTaxonAbbrev($col);
  }
}

sub getDbHandle {
  my $c = new ApiCommonWebsite::Model::ModelConfig($model);

  my $dsn = $c->getDbiDsn();
  my $login = $c->getLogin();

  my $dbh = DBI->connect(
                $c->getDbiDsn, 
                $c->getLogin, 
                $c->getPassword,
                { PrintError => 1, RaiseError => 0}
                ) or die "Can't connect to the database: $DBI::errstr\n";
  return $dbh;
}
